name: Generate Metrics

on:
  schedule:
    - cron: "0 */12 * * *"      # svaka 12h
  workflow_dispatch:
  push:
    branches: ["main"]

permissions:
  contents: write

jobs:
  github-metrics:
    runs-on: ubuntu-latest
    steps:
      - name: Generate metrics
        uses: lowlighter/metrics@latest
        with:
          # Osnovno
          token: ${{ secrets.METRICS_TOKEN }}          # PAT: read:user (+ repo ako ≈æeli≈° privatne)
          user: Rrrapce                                 # <-- tvoj GitHub username
          template: classic
          base: header, activity, community, repositories  # header: "Joined GitHub"; community/repositories: "Contributed to X"
          config_timezone: Europe/Sarajevo
          filename: github-metrics.svg
          committer_token: ${{ github.token }}

          # üîπ Activity (commits) + added/removed (lines)
          plugin_activity: yes
          plugin_activity_limit: 5
          plugin_activity_timestamps: yes
          plugin_lines: yes                                # "X added, X removed"
          plugin_lines_history_limit: 12                   # mjeseƒçni scope (mo≈æe≈° diƒái/smanjiti)

          # üîπ Commit activity per time of day / per day
          plugin_habits: yes
          plugin_habits_from: 200                         # broj eventa za analizu
          plugin_habits_days: 30                          # zadnjih 30 dana
          plugin_habits_charts: yes                       # grafovi (time-of-day, day-of-week)
          plugin_habits_trim: yes                         # sakrij 0-value sate/dane

          # üîπ Contributions calendar (heatmap)
          plugin_isocalendar: yes
          plugin_isocalendar_duration: full-year

          # üîπ Languages (Most used)
          plugin_languages: yes
          plugin_languages_limit: 10
          plugin_languages_sections: most-used
          plugin_languages_details: percentage
          plugin_languages_threshold: 1%
          plugin_languages_other: true
          plugin_languages_aliases: "C++:CPP, C#:CSharp"

          # üîπ Language activity (WakaTime) ‚Äî ‚ÄúCurrent total coding time by language/projects/editors‚Äù
          plugin_wakatime: yes
          plugin_wakatime_token: ${{ secrets.WAKATIME_API_KEY }}
          plugin_wakatime_days: 7
          plugin_wakatime_sections: time, projects, languages, editors
          plugin_wakatime_limit: 5
          plugin_wakatime_url: https://wakatime.com

          # üîπ Issues & PRs (Closed/Open, Merged/Open) ‚Äî follow-up preko svih repo-a
          plugin_followup: yes
          plugin_followup_sections: repositories, user
          plugin_followup_indepth: yes

          # üîπ Achievements (sa≈æeto, izgleda fensi)
          plugin_achievements: yes
          plugin_achievements_threshold: C
          plugin_achievements_secrets: yes
          plugin_achievements_display: compact

          # üîπ PageSpeed Insights (opcionalno) ‚Äî postavi URL svoje stranice
          plugin_pagespeed: yes
          plugin_pagespeed_url: https://agentkoala.com   # <-- promijeni
          plugin_pagespeed_detailed: yes
          plugin_pagespeed_screenshot: yes

          # üîπ Mastered technologies & topics
          plugin_topics: yes
          plugin_topics_mode: mastered           # "mastered" > "starred" > "top"
          plugin_topics_sort: stars              # rangiraj po zvjezdicama
          plugin_topics_limit: 12                # koliko prikazati
          plugin_topics_edges: rounded
          plugin_topics_colors: github

  github-metrics-wakatime-week:
    runs-on: ubuntu-latest
    steps:
      - name: WakaTime (last 7 days)
        uses: lowlighter/metrics@latest
        with:
          token: ${{ github.token }}
          user: Rrrapce
          template: classic
          base: ""
          filename: wakatime-week.svg
          committer_token: ${{ github.token }}
          plugin_wakatime: yes
          plugin_wakatime_token: ${{ secrets.WAKATIME_API_KEY }}
          plugin_wakatime_days: 7
          plugin_wakatime_sections: time, languages, projects, editors
          plugin_wakatime_limit: 5
          plugin_wakatime_url: https://wakatime.com
          config_timezone: Europe/Sarajevo

  github-metrics-wakatime-month:
    runs-on: ubuntu-latest
    steps:
      - name: WakaTime (last 30 days)
        uses: lowlighter/metrics@latest
        with:
          token: ${{ github.token }}
          user: Rrrapce
          template: classic
          base: ""
          filename: wakatime-month.svg
          committer_token: ${{ github.token }}
          plugin_wakatime: yes
          plugin_wakatime_token: ${{ secrets.WAKATIME_API_KEY }}
          plugin_wakatime_days: 30
          plugin_wakatime_sections: time, languages, projects, editors
          plugin_wakatime_limit: 5
          plugin_wakatime_url: https://wakatime.com
          config_timezone: Europe/Sarajevo
